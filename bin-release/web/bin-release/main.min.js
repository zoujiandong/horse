var PlayerRunData=function(){function t(){this.speedList=null,this.timeList=null,this.needTime=0}var e=(__define,t),i=e.prototype;return i.updateData=function(t,e,i){null==this.speedList&&(this.speedList=new Array),null==this.timeList&&(this.timeList=new Array),this.speedList.length=0,this.timeList.length=0;var r=0;for(r=0;r<t.length;r++)this.speedList[r]=t[r];for(r=0;r<e.length;r++)this.timeList[r]=e[r];this.needTime=i},t}();egret.registerClass(PlayerRunData,"PlayerRunData");var PlayerRunDataManager=function(){function t(){}var e=(__define,t);e.prototype;return t.clearPlayerRunDataList=function(){t.playerRunDataList.length>0&&(t.playerRunDataList.length=0)},t.initPlayerRunDataList=function(){for(var e=0;e<Global.PLAYER_CNT;e++){var i=new PlayerRunData;t.playerRunDataList.push(i)}},t.updatePlayerRunDataList=function(e,i,r,n){var a=t.playerRunDataList[e];a.updateData(r,i,n)},t.getFinalResult=function(){for(var e,i=new Array,r=new Array,n=0;n<t.playerRunDataList.length;n++){e=new Object,r.push(e),e.index=n+1;var a=t.playerRunDataList[n].needTime;e.needTime=a}var s="";for(n=0;n<r.length;n++)s+="index:"+r[n].index+" needTime:"+r[n].needTime;for(r.sort(t.sortFun),n=0;n<r.length;n++)i.push(r[n].index);return i},t.sortFun=function(t,e){return t.needTime<e.needTime?-1:1},t.playerRunDataList=new Array,t}();egret.registerClass(PlayerRunDataManager,"PlayerRunDataManager");var BottomLayer=function(t){function e(){t.call(this),this.currentTF=null,this.firstTF=null,this.bigTF=null,this.coupleTF=null,this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){var t=Global.createBitmapByName("buttombg");this.addChild(t),this.currentTF=new egret.TextField,this.currentTF.textColor=9729387,this.addChild(this.currentTF),this.currentTF.size=20,this.currentTF.x=50,this.currentTF.y=40,this.firstTF=new egret.TextField,this.addChild(this.firstTF),this.firstTF.size=20,this.firstTF.x=382-this.firstTF.textWidth/2,this.firstTF.y=40,this.bigTF=new egret.TextField,this.addChild(this.bigTF),this.bigTF.size=20,this.bigTF.x=432-this.bigTF.textWidth/2,this.bigTF.y=40,this.coupleTF=new egret.TextField,this.addChild(this.coupleTF),this.coupleTF.size=20,this.coupleTF.x=483-this.coupleTF.textWidth/2,this.coupleTF.y=40},r.updateLastToCurrent=function(){var t=this.convertToDateStr(Global.GAME_END_TIME),e=Global.GAME_NO+"";this.currentTF.text=t+"    "+e;var i=PlayerRunDataManager.getFinalResult(),r=-1;if(r=i[0],-1!=r){var n,a;n=4>=r?!1:!0,a=r%2==0?!0:!1,this.firstTF.textColor=13908281,this.firstTF.text=""+r,n?(this.bigTF.textColor=15869067,this.bigTF.text="大"):(this.bigTF.textColor=5480684,this.bigTF.text="小"),a?(this.coupleTF.textColor=15869067,this.coupleTF.text="双"):(this.coupleTF.textColor=5480684,this.coupleTF.text="单")}else this.firstTF.text="",this.bigTF.text="",this.coupleTF.text="";Global.Gaming&&(this.firstTF.text="",this.bigTF.text="",this.coupleTF.text="")},r.updateLast=function(){if(Global.CURRENT_STATUS==Global.PREGAMESTATUS||Global.CURRENT_STATUS==Global.RESTSTR)if(Global.historyList.length>0){var t=Global.historyList[0],e=this.convertToDateStr(t.finish);this.currentTF.textColor=9729387,this.currentTF.text=e+"   "+t.no;var i=-1,r=t.horses;if(r&&r.length>0&&(i=r[0].id+1),-1!=i){var n,a;n=4>=i?!1:!0,a=i%2==0?!0:!1,this.firstTF.textColor=13908281,this.firstTF.text=""+i,n?(this.bigTF.textColor=15869067,this.bigTF.text="大"):(this.bigTF.textColor=5480684,this.bigTF.text="小"),a?(this.coupleTF.textColor=15869067,this.coupleTF.text="双"):(this.coupleTF.textColor=5480684,this.coupleTF.text="单")}else this.firstTF.text="",this.bigTF.text="",this.coupleTF.text=""}else this.currentTF.text="",this.firstTF.text="",this.bigTF.text="",this.coupleTF.text=""},r.convertToDateStr=function(t){var e="",i=t,r=new Date(1e3*i),n=r.getFullYear(),a=r.getMonth()+1,s=r.getDate(),l=r.getHours(),o=r.getMinutes(),h=r.getSeconds(),d=(r.getDay(),n+""),u=a>=10?""+a:"0"+a,E=s>=10?""+s:"0"+s,T=l>=10?""+l:"0"+l,c=o>=10?""+o:"0"+o,g=h>=10?""+h:"0"+h;return e=d+"-"+u+"-"+E+"  "+T+":"+c+":"+g},r.clear=function(){},e}(egret.DisplayObjectContainer);egret.registerClass(BottomLayer,"BottomLayer");var CountDownLayer=function(t){function e(){t.call(this),this.timer=null,this.tf=null,this.bg=null,this.isShow=!0,this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},r.init=function(){this.bg=Global.createBitmapByName("countdown"),this.addChild(this.bg),this.bg.x=(Global.STAGE_WIDTH-this.bg.width)/2,this.bg.y=204,this.tf=new egret.TextField,this.addChild(this.tf),this.tf.size=25,this.tf.textColor=16711680,this.tf.x=(Global.STAGE_WIDTH-this.tf.textWidth)/2,this.tf.y=230,this.timer=new egret.Timer(1e3),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),Global.ROOT.addChild(this),this.hide()},r.show=function(){this.isShow||(this.visible=!0,this.timer.start(),this.isShow=!0)},r.hide=function(){this.isShow&&(this.visible=!1,this.timer.stop(),this.isShow=!1)},r.onTimer=function(t){var e=0;Global.CURRENT_STATUS==Global.PREGAMESTATUS?(e=Global.GAME_STARE_TIME-Global.NOW_TIME,this.tf.text="倒计时："+Math.floor(e)):Global.CURRENT_STATUS==Global.RESTSTR&&(this.timer&&1==this.timer.running&&this.timer.stop(),this.tf.text="停止"),this.tf.x=(Global.STAGE_WIDTH-this.tf.width)/2,this.tf.y=230},e._instance=null,e}(egret.DisplayObjectContainer);egret.registerClass(CountDownLayer,"CountDownLayer");var EndLine=function(t){function e(e){void 0===e&&(e=!0),t.call(this),this.init(e)}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(t){var e=new egret.MovieClipDataFactory(RES.getRes("flag_json"),RES.getRes("flag_png"));this.line=Global.createBitmapByName("road"),this.addChild(this.line),t&&(this.flag1=new egret.MovieClip(e.generateMovieClipData("flag")),this.flag2=new egret.MovieClip(e.generateMovieClipData("flag")),this.flag1.x=63.3,this.flag1.y=-55.95,this.flag2.x=6.3,this.flag2.y=203.55,this.addChild(this.flag1),this.addChild(this.flag2),this.flag1.play(),this.flag2.play(),this.addEventListener(egret.Event.ENTER_FRAME,this.efHandler,this))},r.efHandler=function(t){this.flag1.currentFrame==this.flag1.totalFrames&&this.flag1.gotoAndPlay(1),this.flag2.currentFrame==this.flag2.totalFrames&&this.flag2.gotoAndPlay(1)},r.clear=function(){this.hasEventListener(egret.Event.ENTER_FRAME)&&this.removeEventListener(egret.Event.ENTER_FRAME,this.efHandler,this),this.flag1&&(this.flag1.stop(),this.removeChild(this.flag1),this.flag1=null),this.flag2&&(this.flag2.stop(),this.removeChild(this.flag2),this.flag2=null),this.line&&(this.removeChild(this.line),this.line=null)},e}(egret.DisplayObjectContainer);egret.registerClass(EndLine,"EndLine");var GameResultLayer=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){var t=Global.createBitmapByName("resultBG");this.addChild(t);var e=PlayerRunDataManager.getFinalResult();this.firstHorse=Global.createBitmapByName("horsePic"+e[0]),this.firstHorse.x=240,this.firstHorse.y=170,this.secondHorse=Global.createBitmapByName("horsePic"+e[1]),this.secondHorse.x=80,this.secondHorse.y=170,this.thirdHorse=Global.createBitmapByName("horsePic"+e[2]),this.thirdHorse.x=400,this.thirdHorse.y=170,this.addChild(this.firstHorse),this.addChild(this.secondHorse),this.addChild(this.thirdHorse);var i=egret.Tween.get(this.firstHorse,{loop:!1});i.to({scaleX:1.2,scaleY:1.2},1e3,egret.Ease.sineIn);var r=egret.Tween.get(this.secondHorse,{loop:!1});r.to({scaleX:.8,scaleY:.8},1e3,egret.Ease.sineIn);var n=egret.Tween.get(this.thirdHorse,{loop:!1});n.to({scaleX:.8,scaleY:.8},1e3,egret.Ease.sineIn);var i=egret.Tween.get(this.firstHorse,{loop:!1});i.to({scaleX:1.2,scaleY:1.2},1e3,egret.Ease.sineIn);var a=Global.createBitmapByName("first"),s=Global.createBitmapByName("second"),l=Global.createBitmapByName("third");a.x=240,a.y=49,s.x=80,s.y=70,l.x=400,l.y=70,this.addChild(a),this.addChild(s),this.addChild(l)},r.clear=function(){for(;this.numChildren;)this.removeChildAt(0);this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);egret.registerClass(GameResultLayer,"GameResultLayer");var Ground=function(t){function e(){t.call(this),this.distance=0,this.runTime=0,this.startPos=0,this.endPos=0,this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){this.bgList=new Array;var t=Global.createBitmapByName("ground");this.addChild(t),t.smoothing=!0;var e=Global.createBitmapByName("ground");this.addChild(e),e.smoothing=!0,this.bgList.push(t),this.bgList.push(e),this.resetBgPos(),this.startLine=new EndLine(!1),this.addChild(this.startLine),this.startPos=Global.GOUND_WIDTH-Global.HORSE_GAP-105,this.startLine.x=this.startPos,this.startLine.y=122,this.endLine=new EndLine,this.addChild(this.endLine),this.endPos=-Global.TOTAL_DISTANCE*Global.RUN_SPEED_ADD+Global.GOUND_WIDTH-Global.HORSE_GAP-105,this.endLine.x=this.endPos,this.endLine.y=122,this.addEventListener(egret.Event.ENTER_FRAME,this.efHandler,this)},r.gameStartHandler=function(){this.runTime=Math.max(0,Global.NOW_TIME-Global.GAME_STARE_TIME)},r.onTimer=function(){this.runTime=Math.max(0,Global.NOW_TIME-Global.GAME_STARE_TIME);var t=Global.GROUND_SPEED*(Global.timestamp/1e3);this.bgList[0].x+=t*Global.RUN_SPEED_ADD,this.bgList[1].x+=t*Global.RUN_SPEED_ADD,this.bgList[0].x>=this.bgList[0].width-t&&(this.bgList.reverse(),this.resetBgPos()),null!=this.endLine&&(this.endLine.x=this.endPos+Global.GROUND_SPEED*Global.RUN_SPEED_ADD*this.runTime),null!=this.startLine&&(this.startLine.x=this.startPos+Global.GROUND_SPEED*Global.RUN_SPEED_ADD*this.runTime,this.startLine.x>Global.GOUND_WIDTH+200&&this.removeStartLine())},r.clear=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.efHandler,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHandler,this);for(var t=0;t<this.bgList.length;t++)this.removeChild(this.bgList[t]);this.bgList.length=0,this.removeStartLine(),this.removeEndLine()},r.removeStartLine=function(){this.startLine&&(this.startLine.clear(),this.startLine.parent&&this.startLine.parent.removeChild(this.startLine),this.startLine=null)},r.removeEndLine=function(){this.endLine&&(this.endLine.clear(),this.endLine.parent&&this.endLine.parent.removeChild(this.endLine),this.endLine=null)},r.efHandler=function(t){null==this.endLine&&Global.TOTAL_DISTANCE-this.distance<Global.GOUND_WIDTH},r.removeHandler=function(t){this.removeEventListener(egret.Event.ENTER_FRAME,this.efHandler,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHandler,this);for(var e=0;e<this.bgList.length;e++)this.removeChild(this.bgList[e]);this.bgList.length=0},r.resetBgPos=function(){this.bgList[0].x=0,this.bgList[0].y=0,this.bgList[1].x=this.bgList[0].x-this.bgList[0].width,this.bgList[1].y=this.bgList[0].y},e}(egret.DisplayObjectContainer);egret.registerClass(Ground,"Ground");var HistoryLite=function(t){function e(e,i){t.call(this),this.index=e,this.info=i,this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){var t=null;t=this.index%2==0?Global.createBitmapByName("lite1"):Global.createBitmapByName("lite2"),this.addChild(t);var e=this.info.finish,i=new Date(1e3*e),r=(i.getFullYear(),i.getMonth()+1),n=i.getDate(),a=i.getHours(),s=i.getMinutes(),l=i.getSeconds(),o=i.getDay(),h=r>=10?""+r:"0"+r,d=n>=10?""+n:"0"+n,u=a>=10?""+a:"0"+a,E=s>=10?""+s:"0"+s,T=l>=10?""+l:"0"+l,c="";switch(o){case 0:c="周日";break;case 1:c="周一";break;case 2:c="周二";break;case 3:c="周三";break;case 4:c="周四";break;case 5:c="周五";break;case 6:c="周六"}var g=h+"/"+d,R=u+":"+E+":"+T,L=new egret.TextField;L.textAlign=egret.HorizontalAlign.CENTER,L.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(L),L.size=11,L.textColor=9729387,L.text=g+" ["+c+"] "+R,L.x=65-L.textWidth/2,L.y=5;var _=new egret.TextField;this.addChild(_),_.size=11,_.textColor=9729387,_.text=""+this.info.no,_.x=180-_.textWidth/2,_.y=5;var p=-1,f=this.info.horses;if(f&&f.length>0)for(var m=0;m<f.length;m++){var S=f[m],G=S.id;0==m&&(p=G+1);var y=Global.createBitmapByName("num"+(G+1));y.scaleX=y.scaleY=.35,this.addChild(y),y.x=241+m*(y.width*y.scaleX+3),y.y=0}if(-1!=p){var b,v;b=4>=p?!1:!0,v=p%2==0?!0:!1;var C=new egret.TextField;C.textAlign=egret.HorizontalAlign.CENTER,C.verticalAlign=egret.VerticalAlign.MIDDLE,C.textColor=13908281,C.text=""+p,this.addChild(C),C.size=11,C.x=450-C.textWidth/2,C.y=5;var A=new egret.TextField;A.textAlign=egret.HorizontalAlign.CENTER,A.verticalAlign=egret.VerticalAlign.MIDDLE,b?(A.textColor=15869067,A.text="大"):(A.textColor=5480684,A.text="小"),A.size=11,this.addChild(A),A.x=483-A.textWidth/2,A.y=5;var D=new egret.TextField;v?(D.textColor=15869067,D.text="双"):(D.textColor=5480684,D.text="单"),D.size=11,this.addChild(D),D.x=523-D.textWidth/2,D.y=5}},e}(egret.DisplayObjectContainer);egret.registerClass(HistoryLite,"HistoryLite");var HistoryPanel=function(t){function e(){t.call(this),this.urlLoader=null,this.request=null,this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){var t=Global.createBitmapByName("recordTitle");this.addChild(t);var e=Global.createBitmapByName("more");this.addChild(e),e.x=440,e.y=6;var i=Global.createBitmapByName("recordDesc");this.addChild(i),i.x=0,i.y=t.y+t.height,this.historyContainer=new egret.DisplayObjectContainer,this.addChild(this.historyContainer),this.historyContainer.x=0,this.historyContainer.y=i.y+i.height,this.urlLoader=new egret.URLLoader,this.urlLoader.dataFormat=egret.URLLoaderDataFormat.TEXT,this.urlLoader.addEventListener(egret.Event.COMPLETE,this.onCompltetHandler,this),this.urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.ioErrorHandler,this),this.request=new egret.URLRequest,this.request.url=Global.URL1,this.request.method=egret.URLRequestMethod.GET},r.Request=function(){this.urlLoader.load(this.request)},r.onCompltetHandler=function(t){var e=t.target,i=e.data,r=i.toString(),n=JSON.parse(r);this.updateHistoryList(n),Global.gameEventDispatcher.dispatchEvent(new egret.Event(Global.HISTORY_RECEIVE)),this.refresh()},r.updateHistoryList=function(t){Global.historyList.length=0;for(var e=t,i=0;i<e.length;i++){var r=e[i];Global.historyList.push(r)}},r.refresh=function(){this.historyClear();for(var t=0;t<Global.historyList.length;t++){var e=Global.historyList[t],i=new HistoryLite(t,e);this.historyContainer.addChild(i),i.y=20*t}},r.sort=function(t,e){return t.finish>e.finish?-1:1},r.historyClear=function(){for(;this.historyContainer.numChildren;)this.historyContainer.removeChildAt(0)},r.clear=function(){for(this.historyClear();this.numChildren>0;)this.removeChildAt(0)},r.ioErrorHandler=function(t){},e}(egret.DisplayObjectContainer);egret.registerClass(HistoryPanel,"HistoryPanel");var Horse=function(t){function e(e){t.call(this),this.index=e,this.res="man1",this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){var t=this.res+"_json",e=RES.getRes(t),i=RES.getRes("man1"),r=new egret.MovieClipDataFactory(e,i);this.mc=new egret.MovieClip(r.generateMovieClipData("man1")),this.addChild(this.mc),this.indexTF=new egret.TextField,this.indexTF.size=100,this.indexTF.text=""+this.index,this.addChild(this.indexTF),this.mc.addEventListener(egret.Event.ENTER_FRAME,this.efHandler,this),this.mc.play()},r.efHandler=function(t){this.mc.currentFrame==this.mc.totalFrames&&this.mc.gotoAndPlay(1)},e}(egret.DisplayObjectContainer);egret.registerClass(Horse,"Horse");var Player=function(t){function e(e){t.call(this),this.runTime=0,this.speed=12,this.distance=0,this.runData=null,this.indexI=-1,this.index=e,this.res="horse"+this.index,this.status=Global.PLAYER_STATUS_WAIT,this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){this.runData=PlayerRunDataManager.playerRunDataList[this.index-1];var t=this.res+"_json",e=RES.getRes(t),i=RES.getRes(this.res+"_png"),r=new egret.MovieClipDataFactory(e,i);this.mc=new egret.MovieClip(r.generateMovieClipData(this.res)),this.mc.gotoAndStop(7),this.addChild(this.mc),this.mc.addEventListener(egret.Event.ENTER_FRAME,this.efHandler,this),this.mc.smoothing=!0},r.efHandler=function(t){return this.status==Global.PLAYER_STATUS_WAIT?void this.mc.gotoAndStop(7):void(this.mc.currentFrame==this.mc.totalFrames&&this.mc.gotoAndPlay(1))},r.updateData=function(){this.runData=PlayerRunDataManager.playerRunDataList[this.index-1]},r.onTimer=function(){this.runTime=Math.max(0,Global.NOW_TIME-Global.GAME_STARE_TIME),this.distance=this.getDistance(),this.x=-(this.getDistance()-Global.GROUND_SPEED*this.runTime)*Global.RUN_SPEED_ADD},r.gameStartHandler=function(){this.status=Global.PLAYER_STATUS_RUN,this.runTime=Math.max(0,Global.NOW_TIME-Global.GAME_STARE_TIME),this.mc.play()},r.gameEndHandler=function(){this.status=Global.PLAYER_STATUS_WAIT,this.mc.gotoAndStop(7)},r.clear=function(){this.mc.removeEventListener(egret.Event.ENTER_FRAME,this.efHandler,this),this.index=0,this.res="",this.mc&&(this.mc.stop(),null!=this.mc.parent&&this.mc.parent.removeChild(this.mc),this.mc=null),this.status="",this.runTime=0,this.speed=0,this.distance=0,this.runData=null},r.getDistance=function(){for(var t=this.runTime,e=0,i=0;i<this.runData.timeList.length;i++){if(!(t>=this.runData.timeList[i])){e+=this.runData.speedList[i]*t;break}e+=this.runData.speedList[i]*this.runData.timeList[i],t-=this.runData.timeList[i]}return e},r.getSpeed=function(){for(var t=-1,e=0;e<this.runData.timeList.length;e++){for(var i=0,r=0;e>=r;r++)i+=this.runData.timeList[r];if(this.runTime<i){e!=this.indexI,t=e,this.indexI=e;break}}return this.runData.speedList[t]},e}(egret.DisplayObjectContainer);egret.registerClass(Player,"Player");var PlayerLayer=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){this.playerList=new Array;for(var t,e=Global.PLAYER_CNT-1;e>=0;e--)t=new Player(e+1),this.playerList.push(t),this.addChild(t),t.x=5*-(Global.PLAYER_CNT-1-e),t.y=Global.PLAYER_POS[e]},r.gameStartHandler=function(){for(var t=0;t<Global.PLAYER_CNT;t++)this.playerList[t].gameStartHandler()},r.gameEndHandler=function(){for(var t=0;t<Global.PLAYER_CNT;t++)this.playerList[t].gameEndHandler()},r.onTimer=function(){for(var t,e=0;e<this.playerList.length;e++)t=this.playerList[e],t.onTimer()},r.efHandler=function(t){for(var e,i=0;i<this.playerList.length;i++)e=this.playerList[i],e.distance+=e.speed,e.x-=e.speed-Global.GROUND_SPEED},r.updatePlayerData=function(){for(var t=0;t<this.playerList.length;t++)this.playerList[t].updateData()},r.clear=function(){if(this.playerList){if(this.playerList.length>0){for(var t=0;t<this.playerList.length;t++)this.playerList[t].clear();this.playerList.length=0}this.playerList=null}},e}(egret.DisplayObjectContainer);egret.registerClass(PlayerLayer,"PlayerLayer");var RankLayer=function(t){function e(){t.call(this),this.numberBmpGap=2,this.init(),this.addEventListener(egret.Event.ENTER_FRAME,this.efHandler,this)}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){this.numberContainer=new egret.DisplayObjectContainer,this.addChild(this.numberContainer),this.numberBmpList=new Array;for(var t=new Array,e=0;e<Global.PLAYER_CNT;e++)t.push(e+1);this.render(t)},r.refreshGameEnd=function(){var t=PlayerRunDataManager.getFinalResult();this.render(t)},r.updateLastRank=function(){if((Global.CURRENT_STATUS==Global.PREGAMESTATUS||Global.CURRENT_STATUS==Global.RESTSTR)&&Global.historyList.length>0){var t=new Array,e=Global.historyList[0],i=e.horses;if(i&&i.length>0)for(var r=0;r<i.length;r++)t.push(i[r].id+1);t.length>0&&this.render(t)}},r.efHandler=function(t){if(0!=Global.Gaming){var e=!1,i=this.getRank();null==Global.RANK_LIST?(Global.RANK_LIST=i,e=!0):i.toString()!=Global.RANK_LIST.toString()&&(Global.RANK_LIST=i,e=!0),e&&this.render(Global.RANK_LIST)}},r.getRank=function(){var t=new Array,e=new Array,i=0;for(i=0;i<Global.mainScene.playerLayer.playerList.length;i++){var r=new Object;r.id=Global.mainScene.playerLayer.playerList[i].index,r.dis=Global.mainScene.playerLayer.playerList[i].distance,e.push(r)}for(e.sort(this.sortHandler),i=0;i<e.length;i++)t.push(e[i].id);return t},r.sortHandler=function(t,e){return t.dis>e.dis?-1:1},r.render=function(t){var e=0,i=null;if(0==this.numberContainer.numChildren)for(e=0;e<t.length;e++)i=Global.createBitmapByName("num"+t[e]),this.numberBmpList.push(i),i.scaleX=i.scaleY=.6,this.numberContainer.addChild(i);for(e=0;e<t.length;e++){var r=t[e]-1;i=this.numberBmpList[r],i.x=e*(i.width*i.scaleX+this.numberBmpGap)}},r.clear=function(){if(this.removeEventListener(egret.Event.ENTER_FRAME,this.efHandler,this),this.numberBmpGap=0,this.numberBmpList){if(this.numberBmpList.length>0){for(var t=0;t<this.numberBmpList.length;t++)this.numberBmpList[t].parent.removeChild(this.numberBmpList[t]);this.numberBmpList.length=0}this.numberBmpList=null}if(this.numberContainer){for(;this.numberContainer.numChildren>0;)this.numberContainer.removeChildAt(0);this.numberContainer=null}},e}(egret.DisplayObjectContainer);egret.registerClass(RankLayer,"RankLayer");var Rizhi=function(t){function e(){t.call(this),this.tf=null,this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){var t=new egret.Shape;t.graphics.beginFill(13421772),t.graphics.drawRect(0,0,Global.STAGE_WIDTH,50),t.graphics.endFill(),this.addChild(t),this.tf=new egret.TextField,this.addChild(this.tf),this.tf.textColor=0,this.tf.size=15,this.tf.y=20},r.update=function(t){this.tf.text+=t},r.clear=function(){this.tf.text=""},e}(egret.DisplayObjectContainer);egret.registerClass(Rizhi,"Rizhi");var MainScene=function(t){function e(){t.call(this),this.ground=null,this.playerLayer=null,this.init(),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.clear,this)}__extends(e,t);var i=(__define,e),r=i.prototype;return r.startTimer=function(){this.playerLayer.gameStartHandler(),this.ground.gameStartHandler()},r.stopTimer=function(){this.playerLayer.gameEndHandler()},r.init=function(){this.ground=new Ground,this.addChild(this.ground),this.ground.x=0,this.ground.y=0+Global.TOP_HEIGHT,this.playerLayer=new PlayerLayer,this.addChild(this.playerLayer),this.playerLayer.x=Global.STAGE_WIDTH-80,this.playerLayer.y=15+Global.TOP_HEIGHT},r.updatePlayerData=function(){this.playerLayer.updatePlayerData()},r.getPlayerDisStr=function(){for(var t="",e=0;e<this.playerLayer.playerList.length;e++)t+="index:"+this.playerLayer.playerList[e].index+" distance:"+this.playerLayer.playerList[e].distance;return t},r.onTimer=function(t){this.ground.onTimer(),this.playerLayer.onTimer()},r.clear=function(t){for(this.ground&&(this.ground.clear(),this.ground=null),this.playerLayer&&(this.playerLayer.clear(),this.playerLayer=null);this.numChildren>0;)this.removeChildAt(0)},e}(egret.DisplayObjectContainer);egret.registerClass(MainScene,"MainScene");var TopLayer=function(t){function e(){t.call(this),this.lastIndex=null,this.currentIndex=null,this.currentOpen=null,this.init()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.init=function(){var t=Global.createBitmapByName("topBg");this.addChild(t),this.lastIndex=new egret.TextField,this.lastIndex.size=13,this.lastIndex.textColor=14758209,this.lastIndex.text="",this.addChild(this.lastIndex),this.lastIndex.x=46,this.lastIndex.y=47,this.currentIndex=new egret.TextField,this.currentIndex.size=13,this.currentIndex.textColor=14734641,this.addChild(this.currentIndex),this.currentIndex.text="",this.currentIndex.x=475,this.currentIndex.y=22,this.currentOpen=new egret.TextField,this.currentOpen.size=13,this.currentOpen.textColor=14758209,this.currentOpen.text="",this.addChild(this.currentOpen),this.currentOpen.x=this.currentIndex.x,this.currentOpen.y=43},r.updateLast=function(){if((Global.CURRENT_STATUS==Global.PREGAMESTATUS||Global.CURRENT_STATUS==Global.RESTSTR)&&Global.historyList.length>0){var t=(new Array,Global.historyList[0]),e=t.no;this.lastIndex.text=""+e}},r.updateLastToCurrent=function(){this.lastIndex.text=""+Global.GAME_NO},r.hideCurrent=function(){this.currentIndex.text="",this.currentOpen.text=""},r.updateCurrent=function(){this.currentIndex.text=""+Global.GAME_NO;var t=new Date(1e3*Global.XIAZHU_ENDTIME),e=t.getHours(),i=t.getMinutes(),r=t.getSeconds(),n=e>=10?""+e:"0"+e,a=i>=10?""+i:"0"+i,s=r>=10?""+r:"0"+r,l=n+":"+a+":"+s;this.currentOpen.text=l},r.clear=function(){for(;this.numChildren>0;)this.removeChildAt(0);this.currentIndex=null,this.currentIndex=null,this.currentOpen=null},e}(egret.DisplayObjectContainer);egret.registerClass(TopLayer,"TopLayer");var GameEventDispatcher=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.EventDispatcher);egret.registerClass(GameEventDispatcher,"GameEventDispatcher");var Global=function(){function t(){}var e=(__define,t);e.prototype;return t.Init=function(){t.RANK_LIST&&(t.RANK_LIST.length=0),t.Gaming=!1,t.NOW_TIME=0,t.XIAZHU_ENDTIME=0,t.MANUAL_MODIFY_ENDTIME=0,t.PIECE_TIME=0,t.GAME_STARE_TIME=0,t.RUN_END_TIME=0,t.GAME_END_TIME=0,t.HAS_SEND_HTTP=!1,t.HAS_SEND_HTTP1=!1,t.HAS_RECEIVE_HTTP=!1,t.HAS_RECEIVE_HTTP1=!1,t.HORSE_TMP_DATALIST&&(t.HORSE_TMP_DATALIST.length=0),t.MANUAL_FIRST_ID=-1,t.CURRENT_STATUS="",t.TOTAL_DISTANCE=4e3,t.mainScene=null,t.resultLayer=null,t.initPlayerRunDataList(),t.mainScene=new MainScene,t.MAINSCENE_ROOT.addChild(t.mainScene)},t.FreshGameTime=function(e,i,r){t.NOW_TIME=e,t.GAME_STARE_TIME=i,t.GAME_END_TIME=r},t.GlobalTimerStart=function(){egret.Ticker.getInstance().register(t.globalTimerHd,t)},t.GlobalTimerStop=function(){egret.Ticker.getInstance().unregister(t.globalTimerHd,t)},t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.initPlayerRunDataList=function(){PlayerRunDataManager.clearPlayerRunDataList(),PlayerRunDataManager.initPlayerRunDataList()},t.changeRank=function(e){for(var i=e,r=-1,n=0;n<t.HORSE_TMP_DATALIST.length;n++){var a=t.HORSE_TMP_DATALIST[n];if(a.id==i){r=n;break}}var s=0,l=1e4;for(n=0;n<t.HORSE_TMP_DATALIST.length;n++){var o=t.HORSE_TMP_DATALIST[n];o.needTime<l&&(l=o.needTime,s=n)}s!=r&&(t.HORSE_TMP_DATALIST[s].id=r,t.HORSE_TMP_DATALIST[r].id=s)},t.horseDataHandler=function(){if(t.HORSE_TMP_DATALIST.length>0){for(var e=0;e<t.HORSE_TMP_DATALIST.length;e++){for(var i=t.HORSE_TMP_DATALIST[e],r=i.id,n=i.speed,a=new Array,s=0;s<n.length;s++)a.push(t.PIECE_TIME);var l=i.needTime;PlayerRunDataManager.updatePlayerRunDataList(r,a,n,l)}for(var e=0;e<PlayerRunDataManager.playerRunDataList.length;e++);}},t.GlobalTimerHandler=function(){var e="";t.NOW_TIME<t.GAME_STARE_TIME?(e=t.PREGAMESTATUS,t.CURRENT_STATUS=e,CountDownLayer.getInstance().show(),t.NOW_TIME>=t.MANUAL_MODIFY_ENDTIME+2&&(t.HAS_SEND_HTTP||(t.HAS_SEND_HTTP=!0,Transport.getInstance().sendHttpReq()))):t.NOW_TIME>=t.GAME_STARE_TIME&&t.NOW_TIME<t.RUN_END_TIME?(t.HAS_SEND_HTTP||(Transport.getInstance().sendHttpReq(),t.HAS_SEND_HTTP=!0),e=t.GAMEINGSTR,t.CURRENT_STATUS=e,!t.Gaming&&t.HAS_RECEIVE_HTTP&&(t.Gaming=!0,t.gameEventDispatcher.dispatchEvent(new egret.Event(t.GAME_START_STRING))),CountDownLayer.getInstance().hide()):t.NOW_TIME>=t.RUN_END_TIME&&t.NOW_TIME<t.GAME_END_TIME?(CountDownLayer.getInstance().hide(),t.Gaming=!1,t.HAS_SEND_HTTP||(Transport.getInstance().sendHttpReq(),t.HAS_SEND_HTTP=!0),e=t.SHOWRANKSTR,t.CURRENT_STATUS!=e&&t.HAS_RECEIVE_HTTP&&(t.historyPanel.Request(),t.CURRENT_STATUS=e,t.gameEventDispatcher.dispatchEvent(new egret.Event(t.GAME_END_STRING)))):t.NOW_TIME>=t.GAME_END_TIME&&(CountDownLayer.getInstance().hide(),t.Gaming=!1,t.resultLayer&&(t.resultLayer.clear(),t.resultLayer=null),t.GlobalTimerStop(),t.Init(),Transport.getInstance().sendHttpReqStart())},t.URL="http://fengjie888.gotoip2.com/race/race/race",t.URLSTART="http://fengjie888.gotoip2.com/race/race/race",t.URL1="http://fengjie888.gotoip2.com/race/race/result",t.SERVER_IP="192.168.0.122",t.SERVER_PORT=1900,t.HORSE_GAP=80,t.GOUND_WIDTH=550,t.GOUND_HEIGHT=397,t.TOP_HEIGHT=30,t.GROUND_SPEED=103,t.RUN_SPEED_ADD=3,t.PLAYER_CNT=8,t.PLAYER_POS=[307.5,283.5,259.5,235.5,211.5,187.5,163.5,139.5],t.RANK_LIST=null,t.PLAYER_STATUS_WAIT="player_status_wait",t.PLAYER_STATUS_RUN="player_status_run",t.GAME_START_STRING="gameStart",t.GAME_END_STRING="gameEnd",t.HISTORY_RECEIVE="HistoryList_receive",t.Gaming=!1,t.GAME_NO=0,t.NOW_TIME=0,t.XIAZHU_ENDTIME=0,t.MANUAL_MODIFY_ENDTIME=0,t.PIECE_TIME=0,t.GAME_STARE_TIME=0,t.RUN_END_TIME=0,t.GAME_END_TIME=0,t.HAS_SEND_HTTP=!1,t.HAS_SEND_HTTP1=!1,t.HAS_RECEIVE_HTTP=!1,t.HAS_RECEIVE_HTTP1=!1,t.HORSE_TMP_DATALIST=new Array,t.MANUAL_FIRST_ID=-1,t.CURRENT_STATUS="",t.XIAZHU_STR="xiazhu",t.MANUAL_MODIFY_STR="manualModify",t.GAMEPRE_STR="gamePre",t.GAMEINGSTR="gameing",t.SHOWRANKSTR="showRank",t.GAMEENDSTR="gameEnd",t.RESTSTR="restString",t.PREGAMESTATUS="preGameStatus",t.TOTAL_DISTANCE=4e3,t.gameEventDispatcher=null,t.ROOT=null,t.MAINSCENE_ROOT=null,t.mainScene=null,t.resultLayer=null,t.topLayer=null,t.rankLayer=null,t.bottomLayer=null,t.historyPanel=null,t.historyList=new Array,t.timestamp=0,t.globalTimerHd=function(e){return t.NOW_TIME+=e/1e3,t.timestamp=e,t.Gaming&&t.mainScene&&t.mainScene.onTimer(null),t.GlobalTimerHandler(),!1},t}();egret.registerClass(Global,"Global");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.createView=function(){this.textField=new egret.TextField,this.textField.textColor=0,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},r.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),Global.ROOT=this;var e=new egret.DisplayObjectContainer;Global.MAINSCENE_ROOT=e,Global.ROOT.addChild(Global.MAINSCENE_ROOT),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),r=i.prototype;return r.onAddToStage=function(t){this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,Global.STAGE_WIDTH=this.stage.stageWidth,Global.STAGE_HEIGHT=this.stage.stageHeight,Global.GOUND_WIDTH=Global.STAGE_WIDTH,this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigLoadError,this),RES.loadConfig("resource/resource.json","resource/")},r.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.removeEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},r.onConfigLoadError=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.removeEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigLoadError,this),console.warn("load config error")},r.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},r.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},r.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},r.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)
},r.createGameScene=function(){null==Global.gameEventDispatcher&&(Global.gameEventDispatcher=new GameEventDispatcher,Global.gameEventDispatcher.addEventListener(Global.GAME_START_STRING,this.startGame,this),Global.gameEventDispatcher.addEventListener(Global.GAME_END_STRING,this.endGame,this),Global.gameEventDispatcher.addEventListener(Global.HISTORY_RECEIVE,this.historyReceiveHandler,this)),Global.Init(),Global.topLayer=new TopLayer,Global.ROOT.addChild(Global.topLayer),Global.rankLayer=new RankLayer,Global.ROOT.addChild(Global.rankLayer),Global.rankLayer.x=120,Global.rankLayer.y=15,Global.bottomLayer=new BottomLayer,Global.ROOT.addChild(Global.bottomLayer),Global.bottomLayer.y=Global.TOP_HEIGHT+Global.GOUND_HEIGHT,Global.historyPanel=new HistoryPanel,Global.ROOT.addChild(Global.historyPanel),Global.historyPanel.x=0,Global.historyPanel.y=490,Transport.getInstance().InitHTTP(),Transport.getInstance().sendHttpReqStart()},r.startGame=function(t){Global.mainScene.startTimer(),Global.topLayer.hideCurrent(),Global.topLayer.updateLastToCurrent(),Global.bottomLayer.updateLastToCurrent()},r.endGame=function(t){Global.mainScene.stopTimer(),Global.MAINSCENE_ROOT.removeChild(Global.mainScene),Global.mainScene=null,Global.resultLayer||(Global.resultLayer=new GameResultLayer),Global.MAINSCENE_ROOT.addChild(Global.resultLayer),Global.resultLayer.y=Global.TOP_HEIGHT,Global.rankLayer.refreshGameEnd(),Global.topLayer.hideCurrent(),Global.topLayer.updateLastToCurrent(),Global.bottomLayer.updateLastToCurrent()},r.historyReceiveHandler=function(t){Global.bottomLayer.updateLast(),Global.rankLayer.updateLastRank(),Global.topLayer.updateLast()},r.startAnimation=function(t){for(var e=this,i=new egret.HtmlTextParser,r=[],n=0;n<t.length;n++)r.push(i.parser(t[n]));var a=e.textfield,s=-1,l=function(){s++,s>=r.length&&(s=0);var t=r[s];e.changeDescription(a,t);var i=egret.Tween.get(a);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(l,e)};l()},r.changeDescription=function(t,e){t.textFlow=e},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Transport=function(){function t(){this.webSocket=null,this.urlLoaderStart=null,this.urlLoader=null,this.urlLoader1=null}var e=(__define,t),i=e.prototype;return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},i.InitSocket=function(){null==this.webSocket&&(this.webSocket=new egret.WebSocket,this.webSocket.type=egret.WebSocket.TYPE_STRING,this.webSocket.addEventListener(egret.Event.CONNECT,this.onSocketConnected,this),this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.webSocket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this))},i.InitHTTP=function(){null==this.urlLoaderStart&&(this.urlLoaderStart=new egret.URLLoader,this.urlLoaderStart.dataFormat=egret.URLLoaderDataFormat.TEXT,this.urlLoaderStart.addEventListener(egret.Event.COMPLETE,this.onHttpGetCompleteStart,this),this.urlLoaderStart.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onHttpGetErrorStart,this)),null==this.urlLoader&&(this.urlLoader=new egret.URLLoader,this.urlLoader.dataFormat=egret.URLLoaderDataFormat.TEXT,this.urlLoader.addEventListener(egret.Event.COMPLETE,this.onHttpGetComplete,this),this.urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onHttpGetError,this)),null==this.urlLoader1&&(this.urlLoader1=new egret.URLLoader,this.urlLoader1.dataFormat=egret.URLLoaderDataFormat.TEXT,this.urlLoader1.addEventListener(egret.Event.COMPLETE,this.onHttpGetComplete1,this),this.urlLoader1.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onHttpGetError1,this))},i.sendHttpReqStart=function(t){void 0===t&&(t="");var e="";""==t&&(t=Global.URLSTART),e=t;var i=new egret.URLRequest;i.url=e,i.method=egret.URLRequestMethod.GET,this.urlLoaderStart.load(i)},i.sendHttpReq=function(t){void 0===t&&(t="");var e="";""==t&&(t=Global.URL),e=t;var i=new egret.URLRequest;i.url=e,i.method=egret.URLRequestMethod.GET,this.urlLoader.load(i)},i.sendHttpReq1=function(t){void 0===t&&(t="");var e="";""==t&&(t=Global.URL1),e=t;var i=new egret.URLRequest;i.url=e,this.urlLoader1.load(i)},i.onReceiveHorsesDataHandler=function(t){var e=t.now,i=t.betEnd,r=t.controlEnd,n=t.preEnd,a=t.finish,s=a,l=t.len,o=t.pieceTime,h=t.no;if(Global.NOW_TIME=e,Global.XIAZHU_ENDTIME=i,Global.MANUAL_MODIFY_ENDTIME=r,Global.GAME_STARE_TIME=n,Global.GAME_END_TIME=a,Global.TOTAL_DISTANCE=l,Global.PIECE_TIME=o,Global.GAME_NO=h,t.horses&&t.horses.length>0){Global.HORSE_TMP_DATALIST.length=0,s=n+t.horses[0].speed.length*o;for(var d=0;d<t.horses.length;d++)Global.HORSE_TMP_DATALIST.push(t.horses[d]);Global.horseDataHandler()}Global.RUN_END_TIME=s},i.onHttpGetCompleteStart=function(t){var e=t.target,i=e.data,r=i.toString(),n=JSON.parse(r),a=n.no;0==a?(Global.CURRENT_STATUS=Global.RESTSTR,CountDownLayer.getInstance().show(),Global.historyPanel.Request()):(this.onReceiveHorsesDataHandler(n),Global.GlobalTimerHandler(),Global.GlobalTimerStart(),Global.historyPanel.Request(),Global.topLayer.updateCurrent())},i.onHttpGetErrorStart=function(t){},i.onHttpGetComplete=function(t){var e=t.target,i=e.data,r=i.toString(),n=JSON.parse(r);this.onReceiveHorsesDataHandler(n),n.horses&&n.horses.length>0&&(Global.HAS_SEND_HTTP=!0,Global.HAS_RECEIVE_HTTP=!0)},i.onHttpGetError=function(t){},i.onHttpGetComplete1=function(t){Global.HAS_SEND_HTTP1=!0,Global.HAS_RECEIVE_HTTP1=!0;var e=t.target,i=e.data,r=i.toString(),n=JSON.parse(r),a=n.result;Global.MANUAL_FIRST_ID=a,-1!=Global.MANUAL_FIRST_ID&&Global.changeRank(Global.MANUAL_FIRST_ID-1),Global.horseDataHandler()},i.onHttpGetError1=function(t){},i.sendMsg=function(){null!=this.webSocket&&(this.webSocket.writeUTF("a"),this.webSocket.flush())},i.onSocketConnected=function(t){},i.onReceiveMessage=function(t){var e=this.webSocket.readUTF();JSON.parse(e)},i.onSocketClose=function(t){},i.onSocketError=function(t){},t._instance=null,t}();egret.registerClass(Transport,"Transport");